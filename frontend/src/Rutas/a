import React, { useState, useEffect } from 'react';
import Axios from 'axios';

function Componente() {
  const [listaDetalle, setListaDetalle] = useState([]);
  const [detalleSeleccionado, setDetalleSeleccionado] = useState(null);
  const [solicitanteInput, setSolicitanteInput] = useState('');

  useEffect(() => {
    obtenerDetallesSinResolver();
  }, []);

  function obtenerDetallesSinResolver() {
    Axios.get(`http://127.0.0.1:3131/enviarDetallesOC/sinResolver`)
      .then(response => {
        setListaDetalle(response.data);
      })
      .catch(error => {
        console.error('Error al obtener detalles:', error);
      });
  }

  const [preciosProveedores, setPreciosProveedores] = useState({
    proveedor1: '',
    proveedor2: '',
    proveedor3: '',
  });

  const [nombresProveedores, setNombresProveedores] = useState({
    nombreProveedor1: '',
    nombreProveedor2: '',
    nombreProveedor3: '',
  });

  const handlePrecioProveedorChange = (e, proveedor) => {
    setPreciosProveedores({
      ...preciosProveedores,
      [proveedor]: e.target.value,
    });
  };

  const enviarPreciosProveedor = (detalle, proveedor, nombreProveedor, precio) => {
    const data = {
      detalle,
      proveedor,
      nombreProveedor,
      precio,
    };

    Axios.post('http://127.0.0.1:3131/enviarPreciosProveedor', data)
      .then(response => {
        console.log('Informaci贸n de precios del proveedor enviada al backend:', response.data);
      })
      .catch(error => {
        console.error('Error al enviar la informaci贸n de precios del proveedor:', error);
      });
  };

  function mostrarDetalle(detalle) {
    setDetalleSeleccionado(detalle);
  }

  function buscarPorSolicitante() {
    Axios.get(`http://127.0.0.1:3131/enviarDetallesOC/sinResolver/${solicitanteInput}`)
      .then(response => {
        setListaDetalle(response.data);
        setDetalleSeleccionado(null);
      })
      .catch(error => {
        console.error('Error al buscar detalles por solicitante:', error);
      });
  }

  function mostrarDetalles() {
    if (detalleSeleccionado) {
      return (
        <div>
          {/* ... (c贸digo existente) */}
        </div>
      );
    } else {
      return (
        <div>
          {/* ... (c贸digo existente) */}
        </div>
      );
    }
  }

  return (
    <div>
      <h1>Compras pendientes</h1>
      <div className="col">
        <div className="row align-items-start">
          <div className="col-3">
            <ul>
              {listaDetalle.map((detalle, index) => (
                <li key={index} onClick={() => mostrarDetalle(detalle)}>
                  Fecha: {new Date(detalle.fecha).toLocaleDateString()} - Solicitante: {detalle.nombre_solicitante}
                </li>
              ))}
            </ul>
          </div>
          <div className="col-9">
            {mostrarDetalles()}
          </div>
        </div>
      </div>
      <label className="form-label">Solicitante que desea ver</label>
      <input
        type="text"
        value={solicitanteInput}
        onChange={(e) => setSolicitanteInput(e.target.value)}
      />
      <button type="button" onClick={buscarPorSolicitante}>
        Buscar por Solicitante
      </button>
    </div>
  );
}

export default Componente;
